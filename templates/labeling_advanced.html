<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒì§€ ëª¨ë¸ ë¼ë²¨ë§ ë„êµ¬</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { margin: 0; padding: 0; }
        .advanced-container { width: 100vw; height: 100vh; margin: 0; padding: 0; display: flex; flex-direction: column; }
        .header { height: 80px; padding: 10px 20px; }
        .layout { display: grid; grid-template-columns: 280px 1fr 380px; gap: 0; height: calc(100vh - 80px); }
        .image-list-panel { background: white; padding: 15px; border-right: 1px solid #e5e8eb; overflow-y: auto; }
        .image-item { display: flex; align-items: center; gap: 10px; padding: 8px; border: 1px solid #eee; border-radius: 6px; margin-bottom: 8px; cursor: pointer; }
        .image-item:hover { background: #f8f9fa; }
        .image-item.active { background: #e3f2fd; border-color: #2196f3; }
        .image-item.completed { background: #e8f5e8; border-color: #4caf50; }
        .image-thumbnail { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        .image-info { flex: 1; font-size: 12px; }
        .image-status { font-size: 10px; padding: 2px 6px; border-radius: 10px; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-reviewing { background: #ffeaa7; color: #d63031; }
        .main-panel { background: white; padding: 15px; display: flex; flex-direction: column; }
        .side-panel { background: white; padding: 15px; border-left: 1px solid #e5e8eb; overflow-y: auto; }
        
        .image-workspace { position: relative; }
        .image-workspace { flex: 1; display: flex; flex-direction: column; }
        .canvas-container { flex: 1; position: relative; border: 1px solid #e5e8eb; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .bbox-canvas { cursor: crosshair; }
        
        .toolbar { display: flex; gap: 10px; margin-bottom: 15px; }
        .tool-btn { padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer; }
        .tool-btn.active { background: #3182f6; color: white; }
        
        .bbox-list { max-height: 300px; overflow-y: auto; }
        .bbox-item { padding: 8px; border: 1px solid #eee; margin-bottom: 5px; border-radius: 4px; }
        .bbox-item:hover { background: #f8f9fa; }
        .bbox-item.selected { background: #e3f2fd; border-color: #2196f3; }
        
        .quick-labels { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 15px; }
        .quick-label { padding: 8px; text-align: center; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .quick-label:hover { background: #f0f0f0; }
        .quick-label.selected { background: #3182f6; color: white; }
        
        .stats { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .stat-item { display: flex; justify-content: space-between; margin-bottom: 8px; }
        
        .batch-upload { border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 15px; }
        .batch-upload.dragover { border-color: #3182f6; background: rgba(49, 130, 246, 0.05); }
    </style>
</head>
<body>
    <div class="advanced-container">
        <div class="header">
            <h1 class="title">ğŸ”¬ íƒì§€ ëª¨ë¸ ë¼ë²¨ë§ ë„êµ¬</h1>
            <div class="nav-links">
                <a href="/" class="nav-link">íƒì§€/ë¶„ë¥˜</a>
                <a href="/labeling_detection" class="nav-link active">íƒì§€ ëª¨ë¸ ë¼ë²¨ë§</a>
                <a href="/labeling_classification" class="nav-link">ë¶„ë¥˜ ëª¨ë¸ ë¼ë²¨ë§</a>
                <a href="/data_viewer" class="nav-link">ë°ì´í„° ì¡°íšŒ</a>
                {% if session.user_role == 'admin' %}
                <a href="/admin" class="nav-link">ê´€ë¦¬ì</a>
                {% endif %}
            </div>
        </div>
        
        <div class="layout">
            <div class="image-list-panel">
                <h3>ì´ë¯¸ì§€ ëª©ë¡</h3>
                <div class="batch-upload" id="batchUpload">
                    <p>ğŸ“ ì´ë¯¸ì§€ ì—…ë¡œë“œ</p>
                    <input type="file" id="batchFiles" multiple accept="image/*" style="display: none;">
                    <button id="fileSelectBtn">íŒŒì¼ ì„ íƒ</button>
                    <button id="loadPendingBtn" style="margin-left: 10px; background: #28a745;">ë¯¸ê²€ìˆ˜ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
                <div id="imageList"></div>
            </div>
            
            <div class="main-panel">
                <div class="toolbar">
                    <button class="tool-btn active" id="selectTool">ì„ íƒ</button>
                    <button class="tool-btn" id="panTool">ì´ë™</button>
                    <button class="tool-btn" id="bboxTool">ë°”ìš´ë”©ë°•ìŠ¤</button>
                    <div style="margin-left: auto;">
                        <button class="tool-btn" id="undoBtn">ì‹¤í–‰ì·¨ì†Œ</button>
                        <button class="tool-btn" id="clearAllBtn">ì „ì²´ì‚­ì œ</button>
                    </div>
                </div>
                

                
                <div class="image-workspace">
                    <div class="canvas-container" id="canvasContainer">
                        <canvas id="mainCanvas"></canvas>
                    </div>
                </div>
                
                <div class="image-controls" style="margin-top: 15px;">
                    <input type="range" id="zoomSlider" min="1" max="5" step="0.1" value="1" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>100%</span>
                        <span id="zoomValue">100%</span>
                        <span>500%</span>
                    </div>
                </div>
            </div>
            
            <div class="side-panel">
                <div class="stats">
                    <h3>í†µê³„</h3>
                    <div class="stat-item">
                        <span>ì´ ì´ë¯¸ì§€:</span>
                        <span id="totalImages">0</span>
                    </div>
                    <div class="stat-item">
                        <span>ë¼ë²¨ë§ ì™„ë£Œ:</span>
                        <span id="labeledImages">0</span>
                    </div>
                    <div class="stat-item">
                        <span>ë°”ìš´ë”©ë°•ìŠ¤:</span>
                        <span id="totalBboxes">0</span>
                    </div>
                </div>
                
                <h3>ì¢… ê²€ìƒ‰</h3>
                <div class="form-group" style="position: relative;">
                    <input type="text" id="koreanNameSearch" placeholder="êµ­ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë¬´ë‹¹)">
                    <div id="koreanSearchResults" style="display: none; position: absolute; background: white; border: 1px solid #ccc; border-radius: 4px; max-height: 200px; overflow-y: auto; z-index: 1000; width: 100%; margin-top: 2px;"></div>
                </div>
                
                <div class="form-group" style="position: relative;">
                    <input type="text" id="scientificNameSearch" placeholder="í•™ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: Harmonia)">
                    <div id="scientificSearchResults" style="display: none; position: absolute; background: white; border: 1px solid #ccc; border-radius: 4px; max-height: 200px; overflow-y: auto; z-index: 1000; width: 100%; margin-top: 2px;"></div>
                </div>
                
                <div class="form-group">
                    <label>ê²€ìˆ˜ì:</label>
                    <input type="text" id="reviewer" placeholder="ì´ë¦„ ì…ë ¥" value="Admin">
                </div>
                

                
                <div class="form-group">
                    <label>ëª© (Order):</label>
                    <input type="text" id="orderInput" placeholder="ì˜ˆ: Coleoptera">
                </div>
                
                <div class="form-group">
                    <label>ê³¼ (Family):</label>
                    <input type="text" id="familyInput" placeholder="ì˜ˆ: Coccinellidae">
                </div>
                
                <div class="form-group">
                    <label>ì† (Genus):</label>
                    <input type="text" id="genusInput" placeholder="ì˜ˆ: Harmonia">
                </div>
                
                <div class="form-group">
                    <label>ì¢… (Species):</label>
                    <input type="text" id="speciesInput" placeholder="ì˜ˆ: axyridis">
                </div>
                
                <h3>ë°”ìš´ë”©ë°•ìŠ¤ ëª©ë¡</h3>
                <div class="bbox-list" id="bboxList"></div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" id="saveAllBtn" style="width: 100%; margin-bottom: 10px;">ëª¨ë“  ë°ì´í„° ì €ì¥</button>
                    <button class="btn" id="markReviewBtn" style="width: 100%; background: #ffc107; color: black; margin-bottom: 10px;">ê²€í†  í•„ìš”</button>

                    <button class="btn" id="loadReviewingBtn" style="width: 100%; background: #fd7e14; color: white; margin-bottom: 10px;">ê²€í†  íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>

                    <button class="btn" id="excludeBtn" style="width: 100%; background: #dc3545; color: white; margin-bottom: 10px;">ë¼ë²¨ë§ ëŒ€ìƒì—ì„œ ì œì™¸</button>
                    <button class="btn btn-secondary" id="exportBtn" style="width: 100%;">YOLO í˜•ì‹ ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <a href="/logout" style="position: fixed; bottom: 20px; right: 20px; background: #e74c3c; color: white; padding: 10px 15px; border-radius: 50px; text-decoration: none; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 9999;">ğŸšº ë¡œê·¸ì•„ì›ƒ</a>
    
    <script src="{{ url_for('static', filename='labeling_advanced.js') }}"></script>
    <script src="{{ url_for('static', filename='taxonomy_autocomplete.js') }}"></script>
    <script src="{{ url_for('static', filename='korean_name_search.js') }}"></script>
</body>
</html>