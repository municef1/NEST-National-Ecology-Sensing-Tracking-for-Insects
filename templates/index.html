<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>곤충 탐지 및 분류 시스템</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <h1 class="title">🐛 곤충 탐지 및 분류</h1>
            <p class="subtitle">AI 기반 2단계 분석 시스템</p>
            <div class="nav-links">
                <a href="/" class="nav-link active">탐지/분류</a>
                <a href="/labeling_detection" class="nav-link">탐지 모델 라벨링</a>
                <a href="/labeling_classification" class="nav-link">분류 모델 라벨링</a>
                <a href="/data_viewer" class="nav-link">데이터 조회</a>
                {% if session.user_role == 'admin' %}
                <a href="/admin" class="nav-link">관리자</a>
                {% endif %}
            </div>
        </header>

        <!-- 단계 표시 -->
        <div class="steps">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-label">곤충 탐지</div>
            </div>
            <div class="step-divider"></div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-label">목 분류</div>
            </div>
        </div>

        <!-- 1단계: 탐지 -->
        <section class="section" id="detection-section">
            <div class="card">
                <h2 class="card-title">1단계: 곤충 탐지</h2>
                <p class="card-description">곤충이 포함된 이미지를 업로드하세요. AI가 자동으로 곤충을 찾아드립니다.</p>
                
                <div class="upload-area" id="detection-upload-area">
                    <input type="file" id="detection-file-input" accept="image/*" style="display: none;">
                    <div class="upload-icon">📷</div>
                    <p class="upload-text">클릭하거나 이미지를 드래그하세요</p>
                    <p class="upload-hint">JPG, PNG, GIF (최대 16MB)</p>
                </div>

                <div class="result-area" id="detection-result" style="display: none;">
                    <img id="detection-image" alt="탐지 결과">
                    <div class="result-info" id="detection-info"></div>
                    <button class="btn btn-primary" id="proceed-to-classification">다음 단계로 →</button>
                </div>

                <div class="loading" id="detection-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>탐지 중...</p>
                </div>
            </div>
        </section>

        <!-- 2단계: 분류 -->
        <section class="section" id="classification-section" style="display: none;">
            <div class="card">
                <h2 class="card-title">2단계: 목 분류</h2>
                <p class="card-description">탐지된 곤충의 세부 사진을 업로드하세요. 곤충의 목(目) 정보를 제공합니다.</p>
                
                <div class="upload-area" id="classification-upload-area">
                    <input type="file" id="classification-file-input" accept="image/*" style="display: none;">
                    <div class="upload-icon">🔍</div>
                    <p class="upload-text">곤충의 세부 사진을 업로드하세요</p>
                    <p class="upload-hint">더 선명한 사진일수록 정확합니다</p>
                </div>

                <div class="result-area" id="classification-result" style="display: none;">
                    <img id="classification-image" alt="분류 대상">
                    
                    <div class="species-card">
                        <h3 class="species-name" id="species-name"></h3>
                        <p class="species-scientific" id="species-scientific"></p>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidence-fill"></div>
                            <span class="confidence-text" id="confidence-text"></span>
                        </div>
                    </div>

                    <div class="species-info" id="species-info"></div>

                    <div class="top-predictions" id="top-predictions"></div>

                    <button class="btn btn-secondary" id="retry-classification">다른 이미지로 다시 분류</button>
                    <button class="btn btn-secondary" id="restart">처음부터 다시 시작</button>
                </div>

                <div class="loading" id="classification-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>분류 중...</p>
                </div>
            </div>
        </section>
    </div>

    <!-- 로그아웃 버튼 -->
    <a href="/logout" style="position: fixed; bottom: 20px; right: 20px; background: #e74c3c; color: white; padding: 10px 15px; border-radius: 50px; text-decoration: none; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 9999;">🚺 로그아웃</a>
    
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>

